# Agent 执行模型（公开工程版）

本文说明 **Agent Runner 如何处理工具（tool）的执行结果**，以及为什么最终只返回最后一次工具执行的结果。  
适用于工程说明、开源文档与面试讲解。

---

## 总览（Overview）

当 Agent 生成的执行计划（plan）中包含工具调用时：

- 每一次工具执行都会产生一个结果
- 所有结果会**按执行顺序**记录在 payload 的 `execution_results` 字段中

示意结构：

```json
"execution_results": [
  { "step_id": "...", "tool": "...", "output": {...} }
]
```

该结构用于完整保留 Agent 的执行轨迹。

---

## 为什么返回最后一个结果

Agent Runner 约定：  
**最后一次工具执行结果，代表最终对外输出。**

在代码中通常表现为：

```python
last = results[-1]
```

含义说明：

- `results`：所有工具执行结果的列表
- `results[-1]`：列表中的最后一个元素，即最后一次工具调用结果

该约定基于以下执行模式：

- 前面的工具：负责准备、检索、转换等中间过程
- 最后一个工具：负责生成用户真正需要的最终结果

---

## 设计收益（Design Benefits）

这种设计带来的工程收益包括：

- ✅ 支持多步骤、多工具的 Agent 工作流
- ✅ 保留完整中间结果，便于调试与问题定位
- ✅ 对外输出契约清晰，只暴露最终结果

---

## 执行流程示意（Execution Flow）

```
用户输入
 → Agent 生成执行计划（Plan）
 → 工具按顺序执行
 → 返回最后一次工具执行结果
```

---

## 核心结论（Key Point）

> Agent Runner 会保留完整的工具执行轨迹，  
> 但仅将 **最后一次工具执行结果** 作为最终对外输出，  
> 以保证工程行为可控、输出契约稳定。
