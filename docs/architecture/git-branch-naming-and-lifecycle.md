# Git 分支命名与生命周期规则

> 本文用于**固化本项目的 Git 分支使用规范**，确保：
> - 主分支安全
> - 开发过程清晰
> - 历史可读、可维护、可展示
>
> 适用于：个人项目 / 小团队项目 / 无强 CI 阶段的工程。

---

## 一、分支角色总览（必须理解）

| 分支类型 | 是否长期存在 | 是否受保护 | 作用说明 |
|------|-------------|------------|----------|
| `main` | ✅ 是 | ✅ 是 | 稳定分支，仅承载**阶段性结果** |
| `dev` | ✅ 是 | ⭕ 可选 | 工作主线，所有开发的汇总入口 |
| `feature/*` | ❌ 否 | ❌ 否 | 功能/任务开发分支，用完即删 |
| `fix/*` | ❌ 否 | ❌ 否 | 紧急修复/事故处理分支，用完即删 |
| `patch-*` | ❌ 否 | ❌ 否 | GitHub 网页临时分支，应立即删除 |

---

## 二、主分支（main）使用规则

### 角色定位
- `main` = **稳定结果展示分支**
- 不承载开发过程，只承载「已完成、可展示、可回溯」的结果

### 强制规则
- ❌ 禁止直接 push
- ❌ 禁止 force push
- ✅ 只能通过 PR 合入

### 合入来源
- `dev` → `main`
- （特殊情况）`fix/*` → `main`

---

## 三、开发主线（dev）使用规则

### 角色定位
- `dev` = **唯一工作主线**
- 所有功能、文档、样例的中转站

### 允许的操作
- ✅ 直接 commit
- ✅ push 到远端
- ✅ 接收 `feature/*` / `fix/*` 合并

### 不推荐的操作
- ❌ 长期在 dev 上直接堆积多个不相关 feature
- ❌ 未整理就直接 PR 到 main

---

## 四、功能分支（feature/*）规范

### 命名规范
```text
feature/<short-description>
```

示例：
- `feature/add-base-prompts`
- `feature/rag-retrieval`
- `feature/agent-memory`

### 生命周期
1. 从 `dev` 创建
2. 开发单一功能
3. 合并到 `dev`
4. **立即删除（本地 + 远端）**

---

## 五、修复分支（fix/*）规范

### 使用场景
- 误提交
- 主分支事故
- 紧急修复

### 命名规范
```text
fix/<short-description>
```

示例：
- `fix/rollback-main`

### 生命周期（极短）
1. 从 `main` 或 `dev` 创建
2. 完成修复
3. PR 合入目标分支
4. **立即删除（本地 + 远端）**

---

## 六、临时 patch 分支处理规则（重要）

### 来源
- GitHub 网页直接编辑文件自动生成
- 常见命名：
  - `username-patch-1`
  - `username-patch-2`

### 处理原则
- ❌ 不作为长期分支
- ❌ 不继续开发
- ✅ PR 合并后立即删除
- ✅ 若未使用，直接删除

---

## 七、分支删除铁律（强烈建议）

> **凡满足以下任一条件，必须删除分支：**

- PR 已 merge
- 分支名为 `feature/*`、`fix/*`
- patch 类临时分支
- 不符合当前命名规范

### 推荐操作
```bash
git branch -d <branch-name>          # 删除本地
git push origin --delete <branch-name> # 删除远端
```

---

## 八、推荐日常工作流（总结）

```text
dev
 ├─ feature/xxx  → 合并 → 删除
 ├─ feature/yyy  → 合并 → 删除
 └─ （阶段完成）→ PR → main
```

---

## 九、设计原则（给未来的自己）

1. main 永远干净
2. dev 承载过程
3. feature / fix 用完即删
4. 分支数量 ≈ 当前进行中的任务数
5. 能一眼看懂的分支结构，才是好工程

---

（本文为工程规范文档，可长期维护与公开）
