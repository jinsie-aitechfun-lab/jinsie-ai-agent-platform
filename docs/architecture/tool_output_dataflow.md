# Agent 工具输出数据流说明（工程公开版）

本文说明 Agent Runner 中**工具参数与最终输出的来源及处理方式**，用于解释为何最终只返回工具执行结果。

---

## 工具参数的来源

在工具调用型 Agent 中，工具参数来自用户输入，模型在 system prompt 约束下将其结构化为：

```json
"tool": {
  "name": "echo_tool",
  "args": {
    "text": "hi"
  }
}
```

模型仅负责结构化表达，不会修改参数值。

---

## 工具执行与结果记录

每次工具执行都会生成一个结果，并按顺序记录在：

```json
"execution_results": [...]
```

该结构用于保留完整执行轨迹，便于调试与审计。

---

## 为什么返回最后一个结果

Agent Runner 约定：

> **最后一次工具执行结果代表最终对外输出**

因此在实现中使用：

```python
last = results[-1]
```

该设计支持多步、多工具的 Agent 工作流，前置工具用于准备数据，最后一个工具生成最终交付结果。

---

## 执行流程概览

```
用户输入
 → Agent 生成计划（plan）
 → 工具按序执行
 → 返回最后一次工具结果
```

---

## 关键结论

> Agent Runner 保留完整执行轨迹，但仅将最终工具结果作为对外输出，以保证输出契约清晰、工程行为可控。
